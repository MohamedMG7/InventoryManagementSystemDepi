@model InventoryManagementSystem.BLL.Dto.PaymentDtos.PaymentAddDto

@{
    ViewBag.Title = "Create Payment";
}

<h2>Create Payment</h2>

<form asp-action="Create" method="post" id="paymentForm">
    <div class="form-group">
        <label asp-for="PaymentType">Payment Type</label>
        <select asp-for="PaymentType" class="form-control" asp-items="ViewBag.PaymentTypes" id="PaymentType">
            <option value="">-- Select Payment Type --</option>
        </select>
    </div>

    <div class="form-group">
        <label asp-for="PaymentStatus">Payment Status</label>
        <select asp-for="PaymentStatus" class="form-control">
            <option value="Pending">Pending</option>
            <option value="Completed">Completed</option>
            <option value="Failed">Failed</option>
        </select>
    </div>

    <div class="form-group">
        <label asp-for="OrderId">Order ID</label>
        <input asp-for="OrderId" class="form-control" />
    </div>

   
    <div class="form-group" id="visa-info" style="display: none;">
        <label for="CardNumber">Card Number</label>
        <input type="text" id="CardNumber" class="form-control" />
        <span id="cardNumberError" class="text-danger" style="display: none;"></span>

        <label for="CardHolderName" class="mt-2">Card Holder Name</label>
        <input type="text" id="CardHolderName" class="form-control" />
        <span id="cardHolderNameError" class="text-danger" style="display: none;"></span>

        <label for="CVV" class="mt-2">CVV</label>
        <input type="text" id="CVV" class="form-control" />
        <span id="cvvError" class="text-danger" style="display: none;"></span>
    </div>

    
    <div class="form-group" style="margin-top: 20px;">
        <button type="submit" class="btn btn-primary">Create Payment</button>
        <a href="/Payment/PaymentSuccess" class="btn btn-secondary">Back to List</a>

    </div>
</form>

<script>
    document.getElementById("PaymentType").addEventListener("change", function () {
        var paymentType = this.value;
        var visaInfo = document.getElementById("visa-info");
        if (paymentType === "Visa") {
            visaInfo.style.display = "block"; // show filds
        } else {
            visaInfo.style.display = "none"; 
        }
    });

    document.getElementById("paymentForm").addEventListener("submit", function (event) {
        var isValid = true;

       
        if (document.getElementById("PaymentType").value === "Visa") {
            var cardNumber = document.getElementById("CardNumber").value;
            var cardHolderName = document.getElementById("CardHolderName").value;
            var cvv = document.getElementById("CVV").value;

           
            if (!cardNumber || !/^\d{16}$/.test(cardNumber)) {
                document.getElementById("cardNumberError").innerText = "Invalid card number. It should be 16 digits.";
                document.getElementById("cardNumberError").style.display = "block";
                isValid = false;
            } else {
                document.getElementById("cardNumberError").style.display = "none";
            }

           
            if (!cardHolderName || !/^[A-Za-z\s]+$/.test(cardHolderName) || cardHolderName.length < 3) {
                document.getElementById("cardHolderNameError").innerText = "Card holder name is required,letters >3";
                document.getElementById("cardHolderNameError").style.display = "block";
                isValid = false;
            } else {
                document.getElementById("cardHolderNameError").style.display = "none";
            }

            
            if (!cvv || !/^\d{3,4}$/.test(cvv)) {
                document.getElementById("cvvError").innerText = "Invalid CVV. It should be 3 or 4 digits.";
                document.getElementById("cvvError").style.display = "block";
                isValid = false;
            } else {
                document.getElementById("cvvError").style.display = "none";
            }
        }

       
        if (!isValid) {
            event.preventDefault();
        }
    });
</script>
